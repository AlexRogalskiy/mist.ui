<link rel="import" href="../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">
<link rel="import" href="../../bower_components/paper-spinner/paper-spinner.html">

<script src='../../bower_components/moment/min/moment.min.js'></script>
<script src='../../bower_components/timerange-picker/relative.time.parser.js'></script>

<script src='../../bower_components/echarts/dist/echarts.js'></script>

<link rel="import" href="../element-for-in/element-for-in.html">

<dom-module id="gauge-info">
    <template>
        <style include="shared-styles tags-and-labels">
            :host {
                display: inline;
                height: 200px;
            }
            .tag {
                display: inline;
                line-height: 1.6em;
                padding: 4px 8px;
                margin-right: 8px;
            }
            .green {
                background-color: var(--green-color);
                color: #fff;
            }

            .red {
                background-color: var(--red-color);
                color: #fff;
            }

            .orange {
                background-color: var(--orange-color);
                color: #444;
            }
        </style>

        <h2>
            <strong>[[data.Name]]</strong> 
            <span class="tag" hidden="[[!isAbsent]]">[[data.Status.State]]</span>
            <span class$="tag [[_class(data)]]" hidden="[[isAbsent]]">Health: [[data.Status.Health]]</span>
        </h2>
        <div id="gauge" style="width:270px; height:270px;" hidden="[[isAbsent]]">
        </div>
        <div class="absent-gauge" hidden="[[!isAbsent]]"></div>

    </template>
    <script>
    GAUGE_INFO_OPTIONS = {
        tooltip: {
            formatter:  "{a} <br/>{b} : {c}%"
        },
        toolbox: {
            show: true,
            feature: {
                saveAsImage: {
                    show: false,
                    // title: 'save as image',
                    // backgroundColor: '#ffffff'
                }
            },
        },
        series:  [
            {
                name:'fan/temperature',
                type:'gauge',
                detail : {formatter:'{value}%'},
                data:[{value: 50, name: 'data ena'}]
            }
        ]
    };
    GRAY_GAUGE_THEME = {
        color: [
            '#757575','#c7c7c7','#dadada',
            '#8b8b8b','#b5b5b5','#e9e9e9'
        ],
        title: {
            textStyle: {
                fontWeight: 'normal',
                color: '#757575'
            }
        },
        dataRange: {
            color:['#636363','#dcdcdc']
        },
        toolbox: {
            color : ['#757575','#757575','#757575','#757575']
        },
        tooltip: {
            backgroundColor: 'rgba(0,0,0,0.5)',
            axisPointer : {
                type : 'line',
                lineStyle : {
                    color: '#757575',
                    type: 'dashed'
                },
                crossStyle: {
                    color: '#757575'
                },
                shadowStyle : {
                    color: 'rgba(200,200,200,0.3)'
                }
            }
        },
        dataZoom: {
            dataBackgroundColor: '#eee',
            fillerColor: 'rgba(117,117,117,0.2)',
            handleColor: '#757575'
        },
        grid: {
            borderWidth: 0
        },
        categoryAxis: {
            axisLine: {
                lineStyle: {
                    color: '#757575'
                }
            },
            splitLine: {
                lineStyle: {
                    color: ['#eee']
                }
            }
        },
        valueAxis: {
            axisLine: {
                lineStyle: {
                    color: '#757575'
                }
            },
            splitArea : {
                show : true,
                areaStyle : {
                    color: ['rgba(250,250,250,0.1)','rgba(200,200,200,0.1)']
                }
            },
            splitLine: {
                lineStyle: {color: ['#eee']}
            }
        },
        timeline : {
            lineStyle : {
                color : '#757575'
            },
            controlStyle : {
                normal : { color : '#757575'},
                emphasis : { color : '#757575'}
            }
        },
        k: {
            itemStyle: {
                normal: {
                    color: '#8b8b8b',
                    color0: '#dadada',
                    lineStyle: {
                        width: 1,
                        color: '#757575',
                        color0: '#c7c7c7'
                    }
                }
            }
        },
        map: {
            itemStyle: {
                normal: {
                    areaStyle: {
                        color: '#ddd'
                    },
                    label: {
                        textStyle: {
                            color: '#c12e34'
                        }
                    }
                },
                emphasis: {
                    areaStyle: {
                        color: '#99d2dd'
                    },
                    label: {
                        textStyle: {
                            color: '#c12e34'
                        }
                    }
                }
            }
        },
        force : {
            itemStyle: {
                normal: {
                    linkStyle : {
                        color : '#757575'
                    }
                }
            }
        },
        chord : {
            padding : 4,
            itemStyle : {
                normal : {
                    borderWidth: 1,
                    borderColor: 'rgba(128, 128, 128, 0.5)',
                    chordStyle : {
                        lineStyle : {
                            color : 'rgba(128, 128, 128, 0.5)'
                        }
                    }
                },
                emphasis : {
                    borderWidth: 1,
                    borderColor: 'rgba(128, 128, 128, 0.5)',
                    chordStyle : {
                        lineStyle : {
                            color : 'rgba(128, 128, 128, 0.5)'
                        }
                    }
                }
            }
        },
        gauge : {
            axisLine: {
                show: true,
                lineStyle: {
                    color: [[0.2, '#b5b5b5'],[0.8, '#757575'],[1, '#5c5c5c']], 
                    width: 8
                }
            },
            axisTick: {
                splitNumber: 10,
                length :12,
                lineStyle: {color: 'auto'}
            },
            axisLabel: {
                textStyle: {color: 'auto'}
            },
            splitLine: {
                length : 18,
                lineStyle: {color: 'auto'}
            },
            pointer : {
                length : '90%',
                color : 'auto'
            },
            title : {
                textStyle: {color: '#333'}
            },
            detail : {
                textStyle: {color: 'auto'}
            }
        }
    };
    
    Polymer({
        is: 'gauge-info',
        properties: {
            data: {
                type: Object
            },
            type: {
                type: String
            },
            gauge: {
                type: Object
            },
            gaugeOptions: {
                type: Object,
                value: function(){
                    return GAUGE_INFO_OPTIONS;
                }
            },
            isAbsent: {
                type: Boolean,
                computed: '_computedIsAbsent(data.Status.State)'
            },
            gaugeWidth: {
                type: Number,
                value: 200
            }
        },
        observers:[
            '_dataChanged(data)'
        ],
        attached: function(){
            this.initCharts();
        },
        _computedIsAbsent: function(state) {
            return this.data && this.data.Status.State == "Absent";
        },
        initCharts: function(theme) {
            // var grayTheme = GRAY_GAUGE_THEME; 
            // echarts.registerTheme('gray', grayTheme);
            if (!theme) {
                var theme = "default";
            }
            this.gauge = echarts.init(this.$.gauge, theme);
            this.gauge.setOption(this.gaugeOptions);
            // this.updateChartWidth();
            console.log('initialized charts');
        },
        updateChartWidth: function() {
            var parentWidth = this.parentNode.offsetWidth;
            console.log('updateChartWidth', parentWidth);
            if (parentWidth) {
                this.set('gaugeWidth', parentWidth);
                this.resizeGraph();
            }
        },
        _dataChanged: function(data) {
            if (this.type == "temperature") {
                this.set('gaugeOptions.series.0.name', this.type);
                this.set('gaugeOptions.series.0.data', [{value: data.ReadingCelsius, name:''}]);
            } else if (this.type == "fan") { 
                this.set('gaugeOptions.series.0.name', this.type);
                this.set('gaugeOptions.series.0.data', [{value: data.Reading, name:''}]);
            }

            if (this.gauge && data.Status.State == "Absent") {
                console.log('absent');
                echarts.dispose(this.$.gauge);
                this.initCharts('gray');
            }
        },
        _class: function(data) {
            return this.data.Status.Health == "OK" ? "green" : 'orange';
        }
    });
    </script>
</dom-module>